machine:  
  python:
    version: 2.7.10
  node:
    version: 8.0.0
  npm:
    version: 5.0.0

dependencies:  
  pre:
    - pip install ansible
    - pip install --upgrade setuptools
    - npm install npm@latest -g
    - curl -o- -L https://yarnpkg.com/install.sh | TERM=xterm bash
    - npm install coveralls

test:
  override:
    - yarn test
    - cat coverage/lcov.info | node_modules/coveralls/bin/coveralls.js
  post:
    - mkdir $CIRCLE_ARTIFACTS/coveralls
    - mv coverage/html/*.* $CIRCLE_ARTIFACTS/coveralls
    - curl -sSL https://download.sourceclear.com/ci.sh | sh
    
general:
  artifacts:
    - "dist/"
    
deployment:  
  prod:
    branch: master
    commands:
      - yarn build
      - ansible-playbook deployment/deploy.yml -i deployment/vars
